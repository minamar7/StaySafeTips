<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Safe Arrival Timer – Stay Safe Elite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#020617" />

  <style>
    :root {
      --bg: #020617;
      --accent: #38bdf8;
      --gold: #facc15;
      --danger: #ef4444;
      --card: rgba(15, 23, 42, 0.9);
      --glass: rgba(255, 255, 255, 0.03);
    }

    body {
      margin: 0;
      background: var(--bg);
      color: #fff;
      font-family: -apple-system, system-ui, sans-serif;
      text-align: center;
      overflow: hidden;
      min-height: 100vh;
    }

    .app-shell {
      max-width: 480px;
      margin: 0 auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      /* Επαναφορά φυσιολογικού padding */
      padding: 40px 20px 20px; 
      box-sizing: border-box;
    }

    header { margin-bottom: 10px; }
    h1 { font-size: 1.6rem; margin: 0; color: var(--accent); }
    p { color: #94a3b8; font-size: 0.9rem; margin-top: 5px; }

    /* ΤIMER DESIGN - ΕΠΑΝΑΦΟΡΑ ΣΕ ΜΕΓΕΘΟΣ ΠΟΥ ΧΩΡΑΕΙ ΠΑΝΤΟΥ */
    .timer-container {
      position: relative;
      width: 240px; 
      height: 240px;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .timer-svg {
      transform: rotate(-90deg);
      width: 100%;
      height: 100%;
    }

    .timer-circle-bg {
      fill: none;
      stroke: rgba(255,255,255,0.05);
      stroke-width: 10;
    }

    .timer-circle-prog {
      fill: none;
      stroke: var(--accent);
      stroke-width: 10;
      stroke-linecap: round;
      stroke-dasharray: 816; 
      stroke-dashoffset: 0;
      transition: stroke-dashoffset 1s linear, stroke 0.4s;
    }

    .time-display {
      position: absolute;
      font-size: 3.5rem;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
    }

    /* CONTROLS - ΣΠΡΩΞΙΜΟ ΠΡΟΣ ΤΑ ΚΑΤΩ */
    .controls {
      margin-top: auto;
      margin-bottom: 90px; /* Χώρος για τη διαφήμιση και τα tabs */
      display: grid;
      gap: 12px;
      width: 100%;
    }

    .btn {
      padding: 18px;
      border-radius: 20px;
      font-size: 1rem;
      font-weight: 800;
      border: none;
      cursor: pointer;
      transition: 0.2s;
      text-transform: uppercase;
    }

    .btn-arrival { 
      background: var(--accent); 
      color: #020617;
    }

    .btn-cancel { 
      background: rgba(255,255,255,0.05); 
      color: #94a3b8; 
      border: 1px solid rgba(255,255,255,0.1); 
    }
    
    .btn:active { transform: scale(0.96); }

    .alert-active .timer-circle-prog { 
      stroke: var(--danger); 
      animation: blink 0.5s infinite;
    }
    @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
  </style>
</head>
<body>

  <div class="app-shell">
    <header>
      <h1 id="status-title">Safe Arrival</h1>
      <p id="status-desc">Elite monitoring active.</p>
    </header>

    <div class="timer-container" id="timer-box">
      <svg class="timer-svg" viewBox="0 0 280 280">
        <circle class="timer-circle-bg" cx="140" cy="140" r="130"></circle>
        <circle id="progress" class="timer-circle-prog" cx="140" cy="140" r="130"></circle>
      </svg>
      <div class="time-display" id="display">15:00</div>
    </div>

    <div class="controls">
      <button class="btn btn-arrival" onclick="safeArrival()">I HAVE ARRIVED ✅</button>
      <button class="btn btn-cancel" onclick="cancelTimer()">CANCEL SESSION</button>
    </div>
  </div>

  <script>
    let totalSeconds = 15 * 60; 
    let remaining = totalSeconds;
    let timerInterval = null;
    const progressCircle = document.getElementById('progress');
    const display = document.getElementById('display');
    const CIRCUMFERENCE = 2 * Math.PI * 130;

    function startTimer() {
      if (timerInterval) return;
      timerInterval = setInterval(() => {
        remaining--;
        updateUI();

        if (remaining <= 60 && remaining > 0) {
          document.body.classList.add('alert-active');
          if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
        }

        if (remaining <= 0) {
          clearInterval(timerInterval);
          triggerAlert();
        }
      }, 1000);
    }

    function updateUI() {
      const mins = Math.floor(remaining / 60);
      const secs = remaining % 60;
      display.innerText = `${mins}:${secs.toString().padStart(2, '0')}`;
      
      const offset = CIRCUMFERENCE - (remaining / totalSeconds) * CIRCUMFERENCE;
      progressCircle.style.strokeDashoffset = offset;
    }

    function triggerAlert() {
      document.getElementById('status-title').innerText = "⚠️ TIME EXPIRED";
      document.getElementById('status-title').style.color = "var(--danger)";
      document.getElementById('status-desc').innerText = "Sending SOS details...";
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const link = `https://www.google.com/maps?q=${lat},${lon}`;
          window.location.href = `sms:?&body=EMERGENCY! I have not checked in. My last location: ${link}`;
        }, () => {
          window.location.href = `sms:?&body=EMERGENCY! I have not checked in. Location unavailable.`;
        });
      }
    }

    function safeArrival() {
      clearInterval(timerInterval);
      if(window.confetti) {
          confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
      }
      alert("Glad you're safe! +50 XP");
      let xp = parseInt(localStorage.getItem('user_xp')) || 0;
      localStorage.setItem('user_xp', xp + 50);
      window.location.href = 'index.html';
    }

    function cancelTimer() {
      if(confirm("Cancel monitoring?")) {
        clearInterval(timerInterval);
        window.location.href = 'index.html';
      }
    }

    window.onload = () => {
        updateUI();
        startTimer();
    };
  </script>
</body>
</html>
