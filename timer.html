<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Safe Arrival Timer – Stay Safe Elite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#020617" />

  <style>
    :root {
      --bg: #020617;
      --accent: #38bdf8;
      --gold: #facc15;
      --danger: #ef4444;
      --card: rgba(15, 23, 42, 0.9);
    }

    body {
      margin: 0;
      background: var(--bg);
      color: #fff;
      font-family: system-ui, -apple-system, sans-serif;
      text-align: center;
      overflow: hidden;
    }

    .app-shell {
      max-width: 480px;
      margin: 0 auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 60px 20px 40px;
    }

    h1 { font-size: 1.6rem; margin-bottom: 5px; color: var(--accent); }
    p { color: #94a3b8; font-size: 0.9rem; }

    /* TIMER CIRCLE */
    .timer-container {
      position: relative;
      width: 280px;
      height: 280px;
      margin: 40px auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .timer-svg {
      transform: rotate(-90deg);
      width: 100%;
      height: 100%;
    }

    .timer-circle-bg {
      fill: none;
      stroke: rgba(255,255,255,0.05);
      stroke-width: 8;
    }

    .timer-circle-prog {
      fill: none;
      stroke: var(--accent);
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 816; /* 2 * PI * 130 */
      stroke-dashoffset: 0;
      transition: stroke-dashoffset 1s linear, stroke 0.3s;
    }

    .time-display {
      position: absolute;
      font-size: 3.5rem;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
    }

    /* CONTROLS */
    .controls {
      margin-top: auto;
      display: grid;
      gap: 15px;
    }

    .btn {
      padding: 18px;
      border-radius: 20px;
      font-size: 1rem;
      font-weight: 800;
      border: none;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn-arrival { background: var(--accent); color: #000; }
    .btn-cancel { background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.1); }
    
    .btn:active { transform: scale(0.96); }

    /* ALERT STATE */
    .alert-active .timer-circle-prog { stroke: var(--danger); animation: blink 0.5s infinite; }
    @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
  </style>
</head>
<body>

  <div class="app-shell">
    <header>
      <h1 id="status-title">Safe Arrival</h1>
      <p id="status-desc">Timer active. We'll check on you soon.</p>
    </header>

    <div class="timer-container" id="timer-box">
      <svg class="timer-svg">
        <circle class="timer-circle-bg" cx="140" cy="140" r="130"></circle>
        <circle id="progress" class="timer-circle-prog" cx="140" cy="140" r="130"></circle>
      </svg>
      <div class="time-display" id="display">15:00</div>
    </div>

    <div class="controls">
      <button class="btn btn-arrival" onclick="safeArrival()">I HAVE ARRIVED ✅</button>
      <button class="btn btn-cancel" onclick="cancelTimer()">CANCEL & EXIT</button>
    </div>
  </div>

  <script>
    let totalSeconds = 15 * 60; // 15 λεπτά default
    let remaining = totalSeconds;
    let timerInterval = null;
    const progressCircle = document.getElementById('progress');
    const display = document.getElementById('display');
    const CIRCUMFERENCE = 2 * Math.PI * 130;

    function startTimer() {
      timerInterval = setInterval(() => {
        remaining--;
        updateUI();

        if (remaining <= 60) {
          document.body.classList.add('alert-active');
          if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
        }

        if (remaining <= 0) {
          clearInterval(timerInterval);
          triggerAlert();
        }
      }, 1000);
    }

    function updateUI() {
      const mins = Math.floor(remaining / 60);
      const secs = remaining % 60;
      display.innerText = `${mins}:${secs.toString().padStart(2, '0')}`;
      
      const offset = CIRCUMFERENCE - (remaining / totalSeconds) * CIRCUMFERENCE;
      progressCircle.style.strokeDashoffset = offset;
    }

    function triggerAlert() {
      document.getElementById('status-title').innerText = "⚠️ TIME EXPIRED";
      document.getElementById('status-title').style.color = "var(--danger)";
      document.getElementById('status-desc').innerText = "Sending location to emergency contacts...";
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const link = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
          window.location.href = `sms:?&body=I have not checked in! My last location: ${link}`;
        });
      }
    }

    function safeArrival() {
      clearInterval(timerInterval);
      alert("Glad you're safe! +50 XP");
      // Εδώ μπορείς να προσθέσεις XP στο localStorage
      let xp = parseInt(localStorage.getItem('xp')) || 0;
      localStorage.setItem('xp', xp + 50);
      window.location.href = 'index.html';
    }

    function cancelTimer() {
      if(confirm("Are you sure? This will disable your arrival check.")) {
        window.location.href = 'index.html';
      }
    }

    // Έναρξη μόλις φορτώσει
    startQuiz = startTimer();
    updateUI();
  </script>
</body>
</html>
