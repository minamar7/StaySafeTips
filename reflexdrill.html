<script>
const BASE_URL = "https://minamar7.github.io/StaySafeTips/images/tangsoo/";

function loadSafeImage(element, path) {
    const img = new Image();
    img.onload = function() {
        element.src = path;
        element.style.display = "block";
    };
    img.onerror = function() {
        console.log("Image failed:", path);
        element.style.display = "none";
    };
    img.src = path;
}

const drills = [
    { name: "Low Block", korean: "Ha Dan Mahk Kee", img: "lowblock.png", desc: "• Cross arm to opposite shoulder.<br>• Strike downward.<br>• Pivot hips for power." },
    { name: "Middle Punch", korean: "Tung Dan Kong Kyuck", img: "middlepunch.png", desc: "• Target solar plexus.<br>• Rotate fist 180°.<br>• Keep pulling hand tight." },
    { name: "Knife Hand Block", korean: "Sudo Mahk Kee", img: "knifehand.png", desc: "• Use hand blade to deflect.<br>• Fingers tight.<br>• Maintain back stance." },
    { name: "Front Kick", korean: "Ahp Chagee", img: "apkubi.png", desc: "• Chamber knee high.<br>• Strike with the ball of the foot.<br>• Snap back immediately." }
];

let currentDrill = 0;
const totalDrills = 5;

function openGuide() {
    const d = drills[Math.floor(Math.random() * drills.length)];
    document.getElementById('m-desc').innerHTML = `<b style="color:var(--gold)">${d.korean}</b><br><br>${d.desc}`;
    loadSafeImage(document.getElementById('m-img'), BASE_URL + d.img);
    document.getElementById('modalOverlay').style.display = 'flex';
}

function closeModal() {
    document.getElementById('modalOverlay').style.display = 'none';
}

function startTraining() {
    document.getElementById('startBtn').style.visibility = 'hidden';
    runCycle();
}

function runCycle() {
    if (currentDrill >= totalDrills) {
        document.getElementById('successOverlay').style.display = 'flex';
        return;
    }

    document.getElementById('countdown').style.display = 'block';
    document.getElementById('drillImage').style.display = 'none';

    let count = 3;
    const timer = setInterval(() => {
        document.getElementById('countdown').innerText = count;
        count--;
        if (count < 0) {
            clearInterval(timer);
            showDrill();
        }
    }, 1000);
}

function showDrill() {
    const d = drills[Math.floor(Math.random() * drills.length)];

    document.getElementById('countdown').style.display = 'none';

    const img = document.getElementById('drillImage');
    loadSafeImage(img, BASE_URL + d.img);

    document.getElementById('drillName').innerText = d.name;

    currentDrill++;
    document.getElementById('p-bar').style.width = (currentDrill / totalDrills * 100) + "%";
    document.getElementById('p-text').innerText = `Progress: ${currentDrill}/${totalDrills}`;

    setTimeout(runCycle, 4000);
}
</script>